--- gamess.2014.12/lked	2014-12-08 09:56:59.000000000 -0800
+++ patch-files/lked	2015-02-20 19:43:59.000000000 -0800
@@ -1,4 +1,4 @@
-#!/bin/csh
+#!/bin/csh -f
 #
 #  5 Dec 2014 - script to "link-edit" a GAMESS executable
 #
@@ -397,6 +397,7 @@
           breaksw
         case 11:
         case 12:
+        case 13:
           # next attempts a static link, whereas 10 above is a dynamic link.
           # if this fails to work, try the version 10 lines shown just above.
           set MATHLIBS="-Wl,--start-group"
@@ -510,6 +511,7 @@
         case 10:
         case 11:
         case 12:
+        case 13:
           # next are a static link, in single-threaded mode (serial BLAS).
           # The choices preclude any need to
           #     a) install .so shared object libraries on every node,
@@ -528,6 +530,7 @@
         case 10-so:
         case 11-so:
         case 12-so:
+        case 13-so:
           #  next one chooses dynamic linking (so= shared object libs)
           #  Just hand edit GMS_MKL_VERNO in your 'install.info' to use this.
           #  run-time libs (and LD_LIBRARY_PATH) needed on every compute node!
@@ -940,6 +943,7 @@
       set MPILIBS=''
       if ($TARGET == linux64) then
         if (($GMS_DDI_COMM == mpi) || ($GMS_DDI_COMM == mixed)) then
+          setenv LD_LIBRARY_PATH $GMS_MPI_PATH/lib:$LD_LIBRARY_PATH
           switch ($GMS_MPI_LIB)
             case impi:
                set MPILIBS="-L$GMS_MPI_PATH/lib64"
@@ -985,12 +989,15 @@
 #                   one particular cluster needed to look into -libnetdisc.
 #                   Finally, allow it to peek into the runtime/thread libs
 #
-                    set OFEDLIST="-libverbs -lrdmacm -libumad"
-                    if (-e $GMS_OFED_PATH/libibnetdisc.so ) then
-                       set OFEDLIST="$OFEDLIST -libnetdisc"
-                    endif
-                    set MPILIBS="$MPILIBS -L$GMS_OFED_PATH $OFEDLIST"
-                    set MPILIBS="$MPILIBS -lrt -lpthread"
+#                   set OFEDLIST="-libverbs -lrdmacm -libumad"
+#                   if (-e $GMS_OFED_PATH/libibnetdisc.so ) then
+#                      set OFEDLIST="$OFEDLIST -libnetdisc"
+#                   endif
+#                   set MPILIBS="$MPILIBS -L$GMS_OFED_PATH $OFEDLIST"
+#                   set MPILIBS="$MPILIBS -lrt -lpthread"
+                    set MPILIBS="$MPILIBS -L$GMS_MPI_PATH/lib $OFEDLIST"
+                    set MPILIBS="$MPILIBS -llimic2 -lrt -lpthread"
+
                     breaksw
 #
 #                       as of version 2.0, MVAPICH2 seems to have a simple
